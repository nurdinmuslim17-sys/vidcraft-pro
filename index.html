<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VidCraft Pro – Batch Mode</title>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>

<style>
body{
  background:#020617;
  font-family:system-ui;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  padding:20px;
}
.app{
  width:100%;
  max-width:430px;
  background:#0f172a;
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 40px #000;
}
label{font-size:13px;color:#94a3b8}
input,select{
  width:100%;
  background:#020617;
  border:1px solid #1e293b;
  padding:12px;
  border-radius:12px;
  color:white;
  margin-top:6px;
}
button{
  width:100%;
  background:#22c55e;
  color:#022c22;
  border:none;
  padding:14px;
  font-size:16px;
  font-weight:700;
  border-radius:14px;
  margin-top:16px;
}
.small{font-size:12px;color:#94a3b8}
.footer{
  text-align:center;
  font-size:11px;
  color:#64748b;
  margin-top:16px;
}
</style>
</head>

<body>
<div class="app">

<div style="display:flex;gap:12px;align-items:center">
  <div style="width:36px;height:36px;border-radius:12px;
    background:linear-gradient(135deg,#22c55e,#16a34a);
    display:flex;align-items:center;justify-content:center;
    font-weight:900;color:#022c22">V</div>
  <div>
    <div style="font-weight:800">VidCraft Pro</div>
    <div class="small">Batch Video Generator</div>
  </div>
</div>

<p class="small" style="margin:12px 0">
Upload banyak video → jadi konten original otomatis
</p>

<label>Upload Banyak Video</label>
<input type="file" id="videoInput" accept="video/mp4" multiple>
<div class="small">Tip: 3–10 video sekali jalan paling stabil</div>

<label>Nama Produk</label>
<input type="text" id="product" placeholder="Contoh: Motor Listrik">

<label>Voice</label>
<select id="voiceType">
  <option value="female">Wanita (Soft)</option>
  <option value="male">Pria (Tegas)</option>
</select>

<label>Watermark</label>
<input type="text" id="brand" placeholder="VidCraft Pro">
<label><input type="checkbox" id="wmOn" checked> Aktifkan Watermark</label>

<button onclick="generateBatch()">GENERATE SEMUA VIDEO</button>

<div id="progressBox" style="display:none;margin-top:16px">
  <div class="small">
    Video <span id="currentVideo">0</span>/<span id="totalVideo">0</span>
    • <span id="progressText">0%</span>
  </div>
  <div style="width:100%;height:10px;background:#020617;border-radius:999px;overflow:hidden;margin-top:6px">
    <div id="progressBar"
      style="height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#16a34a)">
    </div>
  </div>
</div>

<div class="footer">
© 2026 VidCraft Pro • Batch Mode
</div>

</div>

<script>
const { createFFmpeg, fetchFile } = FFmpeg
const ffmpeg = createFFmpeg({ log:false })

function setProgress(p){
  progressBox.style.display="block"
  progressBar.style.width=p+"%"
  progressText.innerText=p+"%"
}

function buildStory(product){
  const hooks=[
    "Banyak orang nyesel setelah beli ini.",
    "Produk ini lagi viral dan alasannya masuk akal.",
    "Masalah ini sering terjadi kalau salah pilih produk.",
    "Aku juga kaget pas lihat hasilnya."
  ]
  const hook=hooks[Math.floor(Math.random()*hooks.length)]
  const story=`Ini bukan ${product} biasa.
Pilihan tepat untuk kamu yang ingin kualitas dan kenyamanan terbaik.`
  return {hook,story}
}

function generateSRT(hook,story){
  return `1
00:00:00,000 --> 00:00:03,000
${hook}

2
00:00:03,000 --> 00:00:09,000
${story}`
}

async function generateTTS(text,gender){
  return new Promise(async(resolve)=>{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true})
    const rec=new MediaRecorder(stream)
    let chunks=[]
    rec.ondataavailable=e=>chunks.push(e.data)
    rec.onstop=()=>resolve(new Blob(chunks,{type:'audio/webm'}))
    rec.start()

    let voices=speechSynthesis.getVoices()
    if(!voices.length) await new Promise(r=>speechSynthesis.onvoiceschanged=r)
    voices=speechSynthesis.getVoices()

    const utter=new SpeechSynthesisUtterance(text)
    utter.voice=voices.find(v=>v.lang==='id-ID')||voices[0]
    utter.lang='id-ID'
    utter.rate=0.9
    utter.pitch=gender==='male'?0.85:1.15

    utter.onend=()=>{
      setTimeout(()=>{
        rec.stop()
        stream.getTracks().forEach(t=>t.stop())
      },300)
    }
    speechSynthesis.speak(utter)
  })
}

async function generateBatch(){
  const files=[...videoInput.files]
  const productName=product.value
  if(!files.length||!productName) return alert("Lengkapi data")

  totalVideo.innerText=files.length

  if(!ffmpeg.isLoaded()){
    setProgress(5)
    await ffmpeg.load()
  }

  for(let i=0;i<files.length;i++){
    currentVideo.innerText=i+1
    setProgress(10)

    const {hook,story}=buildStory(productName)
    const fullText=hook+" "+story
    const tts=await generateTTS(fullText,voiceType.value)

    ffmpeg.FS('writeFile','input.mp4',await fetchFile(files[i]))
    ffmpeg.FS('writeFile','voice.webm',await fetchFile(tts))
    ffmpeg.FS('writeFile','subs.srt',
      new TextEncoder().encode(generateSRT(hook,story))
    )

    setProgress(60)

    const wmFilter=wmOn.checked
      ? `drawtext=text='${brand.value||"VidCraft Pro"}':
         fontcolor=white@0.18:fontsize=36:x=w-tw-20:y=20`
      : `null`

    await ffmpeg.run(
      '-i','input.mp4',
      '-i','voice.webm',
      '-filter_complex',
      `[0:v]scale=1080:1920,zoompan=z=1.05,${wmFilter},subtitles=subs.srt[v]`,
      '-map','[v]',
      '-map','1:a',
      '-shortest',
      'out.mp4'
    )

    setProgress(90)

    const data=ffmpeg.FS('readFile','out.mp4')
    const url=URL.createObjectURL(new Blob([data.buffer],{type:'video/mp4'}))
    const a=document.createElement("a")
    a.href=url
    a.download=`vidcraft_${i+1}.mp4`
    a.click()

    setProgress(100)
    await new Promise(r=>setTimeout(r,800))
  }
}
</script>

</body>
</html>

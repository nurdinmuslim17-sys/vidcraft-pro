<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VidCraft Pro</title>

<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.6/dist/ffmpeg.min.js"></script>

<style>
body{
  background:#020617;
  font-family:system-ui;
  color:#e5e7eb;
  display:flex;
  justify-content:center;
  padding:20px;
}
.app{
  width:100%;
  max-width:420px;
  background:#0f172a;
  border-radius:20px;
  padding:20px;
  box-shadow:0 0 40px #000;
}
label{font-size:13px;color:#94a3b8}
input,select{
  width:100%;
  background:#020617;
  border:1px solid #1e293b;
  padding:12px;
  border-radius:12px;
  color:white;
  margin-top:6px;
}
button{
  width:100%;
  background:#22c55e;
  color:#022c22;
  border:none;
  padding:14px;
  font-size:16px;
  font-weight:700;
  border-radius:14px;
  margin-top:16px;
}
.footer{
  text-align:center;
  font-size:11px;
  color:#64748b;
  margin-top:16px;
}
</style>
</head>

<body>
<div class="app">

<!-- HEADER -->
<div style="display:flex;gap:12px;align-items:center">
  <div style="width:36px;height:36px;border-radius:12px;
    background:linear-gradient(135deg,#22c55e,#16a34a);
    display:flex;align-items:center;justify-content:center;
    font-weight:900;color:#022c22">V</div>
  <div>
    <div style="font-weight:800">VidCraft Pro</div>
    <div style="font-size:11px;color:#94a3b8">Original Video Generator</div>
  </div>
</div>

<p style="font-size:13px;color:#94a3b8;margin:12px 0">
Turn downloaded videos into original content
</p>

<!-- INPUT -->
<label>Upload Video</label>
<input type="file" id="videoInput" accept="video/mp4">

<label>Nama Produk</label>
<input type="text" id="product" placeholder="Contoh: Motor Listrik">

<label>Voice Storytelling</label>
<select id="voiceType">
  <option value="female">Wanita (Soft)</option>
  <option value="male">Pria (Tegas)</option>
</select>

<label>Watermark Brand</label>
<input type="text" id="brand" placeholder="VidCraft Pro">

<label>
  <input type="checkbox" id="wmOn" checked> Aktifkan Watermark
</label>

<label>Preset Musik</label>
<select id="musicPreset">
  <option value="lofi">Lofi (Santai)</option>
  <option value="cinematic">Cinematic (Dramatis)</option>
  <option value="upbeat">Upbeat (Promosi)</option>
</select>

<button onclick="generate()">GENERATE VIDEO</button>

<!-- PROGRESS -->
<div id="progressBox" style="display:none;margin-top:16px">
  <div style="font-size:12px;color:#94a3b8;margin-bottom:6px">
    Processing <span id="progressText">0%</span>
  </div>
  <div style="width:100%;height:10px;background:#020617;border-radius:999px;overflow:hidden">
    <div id="progressBar"
      style="height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#16a34a)">
    </div>
  </div>
</div>

<div class="footer">
© 2026 VidCraft Pro • Affiliate Video Tool
</div>

</div>

<script>
const { createFFmpeg, fetchFile } = FFmpeg
const ffmpeg = createFFmpeg({ log:false })

const musicConfig={
  lofi:{file:'musik-lofi.mp3',volume:0.18},
  cinematic:{file:'musik-cinematic.mp3',volume:0.22},
  upbeat:{file:'musik-upbeat.mp3',volume:0.3}
}

function setProgress(p){
  progressBox.style.display="block"
  progressBar.style.width=p+"%"
  progressText.innerText=p+"%"
}

function randomStory(product){
  return `Ini bukan ${product} biasa.
Pilihan tepat untuk kamu yang ingin kualitas dan kenyamanan terbaik.`
}

function generateSRT(text){
  return `1
00:00:00,000 --> 00:00:05,000
${text}`
}

async function generateTTS(text,gender){
  return new Promise(async(resolve)=>{
    const stream=await navigator.mediaDevices.getUserMedia({audio:true})
    const rec=new MediaRecorder(stream)
    let chunks=[]
    rec.ondataavailable=e=>chunks.push(e.data)
    rec.onstop=()=>{
      resolve(new Blob(chunks,{type:'audio/webm'}))
    }
    rec.start()

    let voices=speechSynthesis.getVoices()
    if(!voices.length) await new Promise(r=>speechSynthesis.onvoiceschanged=r)
    voices=speechSynthesis.getVoices()

    const utter=new SpeechSynthesisUtterance(text)
    utter.voice=voices.find(v=>v.lang==='id-ID')||voices[0]
    utter.lang='id-ID'
    utter.rate=0.9
    utter.pitch=gender==='male'?0.85:1.15

    utter.onend=()=>{
      setTimeout(()=>{
        rec.stop()
        stream.getTracks().forEach(t=>t.stop())
      },300)
    }
    speechSynthesis.speak(utter)
  })
}

async function generate(){
  try{
    setProgress(1)

    const file=videoInput.files[0]
    const product=product.value
    if(!file||!product) return alert("Lengkapi data")

    const brandText=brand.value||"VidCraft Pro"
    const wm=wmOn.checked
    const voice=voiceType.value
    const preset=musicPreset.value
    const music=musicConfig[preset]

    if(!ffmpeg.isLoaded()){
      setProgress(10)
      await ffmpeg.load()
    }

    setProgress(25)

    const story=randomStory(product)
    const tts=await generateTTS(story,voice)

    ffmpeg.FS('writeFile','input.mp4',await fetchFile(file))
    ffmpeg.FS('writeFile','voice.webm',await fetchFile(tts))
    ffmpeg.FS('writeFile','subs.srt',new TextEncoder().encode(generateSRT(story)))
    ffmpeg.FS('writeFile',music.file,await fetchFile(music.file))

    setProgress(55)

    const wmFilter=wm
      ? `drawtext=text='${brandText}':fontcolor=white@0.18:fontsize=36:x=w-tw-20:y=20`
      : `null`

    await ffmpeg.run(
      '-i','input.mp4',
      '-i','voice.webm',
      '-i',music.file,
      '-filter_complex',
      `
      [2:a]volume=${music.volume}[bg];
      [1:a][bg]amix=inputs=2:dropout_transition=2[audio];
      [0:v]scale=1080:1920,zoompan=z=1.05,${wmFilter},subtitles=subs.srt[v]
      `,
      '-map','[v]',
      '-map','[audio]',
      '-shortest',
      'out.mp4'
    )

    setProgress(90)

    const data=ffmpeg.FS('readFile','out.mp4')
    const url=URL.createObjectURL(new Blob([data.buffer],{type:'video/mp4'}))
    const a=document.createElement("a")
    a.href=url
    a.download="vidcraft-original.mp4"
    a.click()

    setProgress(100)

  }catch(e){
    alert("Error: "+e.message)
  }
}
</script>

</body>
</html>
